# Claude Code Instructions — exponencial

This file provides context and rules for Claude Code when working in this repository.
Read `docs/architecture.md` for the full codebase overview.

---

## Project Summary

**exponencial** is a personal/family full-stack web app built with:
- TanStack Start (React 19, SSR, file-based routing)
- Cloudflare Workers (edge deployment)
- TypeScript strict mode
- Tailwind CSS v4 + shadcn/ui
- Biome (linting + formatting)
- Vitest + Testing Library (tests)

Primary purpose: portfolio showcase for Ricardo (software engineer). Future sub-apps: Finance tracker, File storage.

---

## Key Files to Know

| File | Purpose |
|---|---|
| `docs/architecture.md` | Codebase structure, patterns, and decisions |
| `docs/adr/` | Architecture Decision Records — read before making design choices |
| `docs/plans/` | Future app ideas and specs |
| `src/routes/__root.tsx` | Root layout — wraps all pages |
| `src/router.tsx` | Router instance setup |
| `src/routeTree.gen.ts` | **Auto-generated — never edit** |
| `src/paraglide/` | **Auto-generated — never edit** |
| `vite.config.ts` | Build configuration |
| `biome.json` | Linting/formatting rules |
| `wrangler.jsonc` | Cloudflare Workers deployment config |

---

## Architectural Rules (enforce these)

### 1. Domain-Driven Design
- Organise production code by **domain**, not by technical layer
- New domains: `src/{domain}/domain/`, `application/`, `infrastructure/`, `ui/`, `tests/`
- Demo/scaffold code lives in `demo/` routes and is prefixed with `demo-`; it is exempt from DDD structure
- See ADR-0004 for full guidance

### 2. Testing
- Write **integration tests** at the feature/route level (Testing Library, jsdom)
- Write **unit tests** for domain logic and pure functions (no React, no DOM)
- Never test auto-generated files
- See ADR-0005 for full guidance

### 3. ADRs
- Before making a significant architectural decision, check `docs/adr/` for existing decisions
- When making a new architectural decision, create an ADR in `docs/adr/` using `docs/adr/template.md`
- ADR numbering: next available 4-digit number (e.g., `0006-...`)

### 4. Never Edit Auto-Generated Files
- `src/routeTree.gen.ts` — regenerated by TanStack Router on `vite dev`/`vite build`
- `src/paraglide/` — regenerated by Paraglide on build

### 5. Code Style
- Biome is the enforcer: run `pnpm check` before committing
- Double quotes, tab indentation
- No unused variables or imports (TypeScript strict + Biome)
- Path alias `@/*` maps to `src/*`

---

## Common Commands

```bash
pnpm dev          # Start dev server on port 3000
pnpm build        # Production build
pnpm test         # Run all tests (vitest)
pnpm check        # Biome: lint + format check
pnpm format       # Biome: auto-format
pnpm lint         # Biome: lint only
pnpm deploy       # Build + deploy to Cloudflare Workers
```

---

## Routing Conventions

- Pages: `src/routes/{path}.tsx` or `src/routes/{path}/index.tsx`
- API endpoints: `src/routes/api.{name}.ts` (export HTTP methods)
- Dynamic segments: `$paramName` in filename
- Root layout: `src/routes/__root.tsx`
- Sub-app routes should be namespaced: `/finance/...`, `/files/...`

---

## Environment Variables

Set in `.env.local` (not committed). All are optional except where noted.

| Variable | Purpose |
|---|---|
| `ANTHROPIC_API_KEY` | Claude AI — enables AI features |
| `OPENAI_API_KEY` | OpenAI fallback |
| `GEMINI_API_KEY` | Google Gemini fallback |

AI provider is auto-detected by which key is present (Anthropic → OpenAI → Gemini → Ollama).

---

## What Exists vs. What Is Planned

### Exists (scaffold/demo)
- AI chat with multi-provider support and tool calling
- Guitar product demo (inventory + AI recommendations)
- TanStack Table, Form, Store, Query demos
- MCP server (todos)
- i18n (English + German)
- Cloudflare Workers deployment pipeline

### Planned (see `docs/plans/`)
- Portfolio showcase (primary — replaces demo content on `/`)
- Finance tracker app (`/finance/`)
- File storage & indexing app (`/files/`)

---

## Owner

Ricardo — software engineer. This is a personal/family project.
